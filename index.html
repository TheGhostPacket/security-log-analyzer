<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Log Analyzer | TheGhostPacket</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --bg-input: #f1f5f9;
            --border: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --accent: #6366f1;
            --accent-dark: #4f46e5;
            --success: #16a34a;
            --success-bg: #dcfce7;
            --warning: #d97706;
            --warning-bg: #fef3c7;
            --danger: #dc2626;
            --danger-bg: #fee2e2;
            --info: #0284c7;
            --info-bg: #e0f2fe;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--accent) 0%, #8b5cf6 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
        }

        .logo-text h1 {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .logo-text span {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .header-links {
            display: flex;
            gap: 0.75rem;
        }

        .header-link {
            padding: 0.5rem 1rem;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .header-link:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Hero */
        .hero {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
        }

        .hero-content {
            text-align: center;
            max-width: 700px;
            margin: 0 auto;
        }

        .hero h2 {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 1rem;
        }

        .hero p {
            font-size: 1.1rem;
            opacity: 0.95;
            margin-bottom: 1.5rem;
        }

        .hero-features {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .hero-feature {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }

        /* Main Content */
        .main-content {
            padding-bottom: 3rem;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .card-header i {
            color: var(--accent);
            font-size: 1.1rem;
        }

        .card-header h3 {
            font-size: 1rem;
            font-weight: 600;
        }

        /* How It Works */
        .how-it-works {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 768px) {
            .how-it-works {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .step {
            text-align: center;
            padding: 1.25rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
        }

        .step-number {
            width: 36px;
            height: 36px;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin: 0 auto 0.75rem;
        }

        .step-title {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .step-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Upload Section */
        .upload-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 768px) {
            .upload-section {
                grid-template-columns: 1fr;
            }
        }

        .file-drop-zone {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--bg-input);
        }

        .file-drop-zone:hover,
        .file-drop-zone.drag-over {
            border-color: var(--accent);
            background: rgba(99, 102, 241, 0.05);
        }

        .file-drop-zone i {
            font-size: 3rem;
            color: var(--accent);
            margin-bottom: 1rem;
        }

        .file-drop-zone h4 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .file-drop-zone p {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .file-input {
            display: none;
        }

        .selected-file {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--info-bg);
            border: 1px solid var(--info);
            border-radius: 8px;
            margin-top: 1rem;
        }

        .selected-file i {
            color: var(--info);
            font-size: 1.25rem;
        }

        .selected-file-info {
            flex: 1;
        }

        .selected-file-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .selected-file-size {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .remove-file {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
        }

        .remove-file:hover {
            color: var(--danger);
        }

        /* Paste Area */
        .paste-area {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .paste-area textarea {
            flex: 1;
            min-height: 200px;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.8rem;
            resize: none;
            background: var(--bg-input);
        }

        .paste-area textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .try-sample {
            margin-top: 0.75rem;
            padding: 0.5rem 1rem;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .try-sample:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Supported Formats */
        .supported-formats {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .format-tag {
            padding: 0.3rem 0.6rem;
            background: var(--bg-input);
            border-radius: 6px;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Submit Button */
        .submit-btn {
            width: 100%;
            padding: 1rem;
            margin-top: 1.5rem;
            background: linear-gradient(135deg, var(--accent) 0%, #8b5cf6 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.6rem;
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
        }

        .submit-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .submit-btn .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Results Section */
        .results-section {
            display: none;
        }

        .results-section.active {
            display: block;
        }

        /* Threat Level Banner */
        .threat-banner {
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .threat-banner.critical {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
        }

        .threat-banner.high {
            background: linear-gradient(135deg, #ea580c, #c2410c);
            color: white;
        }

        .threat-banner.medium {
            background: linear-gradient(135deg, #d97706, #b45309);
            color: white;
        }

        .threat-banner.low {
            background: linear-gradient(135deg, #65a30d, #4d7c0f);
            color: white;
        }

        .threat-banner.clean {
            background: linear-gradient(135deg, #16a34a, #15803d);
            color: white;
        }

        .threat-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .threat-level {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .threat-subtitle {
            opacity: 0.9;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--accent);
        }

        .stat-value.danger { color: var(--danger); }
        .stat-value.warning { color: var(--warning); }
        .stat-value.success { color: var(--success); }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        /* Recommendations */
        .recommendation {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }

        .recommendation.critical {
            background: var(--danger-bg);
            border-left: 4px solid var(--danger);
        }

        .recommendation.warning {
            background: var(--warning-bg);
            border-left: 4px solid var(--warning);
        }

        .recommendation.success {
            background: var(--success-bg);
            border-left: 4px solid var(--success);
        }

        .recommendation-icon {
            font-size: 1.25rem;
        }

        .recommendation.critical .recommendation-icon { color: var(--danger); }
        .recommendation.warning .recommendation-icon { color: var(--warning); }
        .recommendation.success .recommendation-icon { color: var(--success); }

        .recommendation-content {
            flex: 1;
        }

        .recommendation-title {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }

        .recommendation-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .recommendation-action {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
            font-style: italic;
        }

        /* IP Table */
        .ip-table {
            width: 100%;
            border-collapse: collapse;
        }

        .ip-table th,
        .ip-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .ip-table th {
            background: var(--bg-input);
            font-weight: 600;
            font-size: 0.85rem;
        }

        .ip-table td {
            font-size: 0.85rem;
        }

        .ip-table tr:hover {
            background: var(--bg-input);
        }

        .ip-address {
            font-family: 'SF Mono', Monaco, monospace;
            font-weight: 500;
        }

        .risk-badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .risk-badge.high {
            background: var(--danger-bg);
            color: var(--danger);
        }

        .risk-badge.medium {
            background: var(--warning-bg);
            color: var(--warning);
        }

        .risk-badge.low {
            background: var(--success-bg);
            color: var(--success);
        }

        .country-flag {
            font-size: 1.1rem;
        }

        /* Threat Types */
        .threat-types {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .threat-types {
                grid-template-columns: 1fr;
            }
        }

        .threat-type-card {
            background: var(--bg-input);
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .threat-type-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--danger-bg);
            color: var(--danger);
        }

        .threat-type-count {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .threat-type-name {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Recent Threats */
        .threat-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .threat-item {
            display: flex;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-input);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .threat-item-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .threat-item-icon.high {
            background: var(--danger-bg);
            color: var(--danger);
        }

        .threat-item-icon.medium {
            background: var(--warning-bg);
            color: var(--warning);
        }

        .threat-item-icon.low {
            background: var(--info-bg);
            color: var(--info);
        }

        .threat-item-content {
            flex: 1;
            min-width: 0;
        }

        .threat-item-type {
            font-weight: 600;
            font-size: 0.85rem;
        }

        .threat-item-evidence {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-family: 'SF Mono', Monaco, monospace;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .threat-item-ip {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem 0;
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .footer a {
            color: var(--accent);
            text-decoration: none;
        }

        /* Info Box */
        .info-box {
            background: var(--info-bg);
            border: 1px solid rgba(2, 132, 199, 0.2);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .info-box h4 {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            color: var(--info);
        }

        .info-box p {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* API Status */
        .api-status {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .api-badge {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.2rem 0.5rem;
            background: var(--bg-input);
            border-radius: 4px;
            font-size: 0.7rem;
        }

        .api-badge .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .api-badge .dot.active { background: var(--success); }
        .api-badge .dot.inactive { background: var(--text-muted); }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-file-shield"></i>
                    </div>
                    <div class="logo-text">
                        <h1>Security Log Analyzer</h1>
                        <span>Threat Detection Tool</span>
                    </div>
                </div>
                <div class="header-links">
                    <a href="https://github.com/TheGhostPacket" target="_blank" class="header-link">
                        <i class="fab fa-github"></i> GitHub
                    </a>
                    <a href="https://theghostpacket.com" target="_blank" class="header-link">
                        <i class="fas fa-globe"></i> Portfolio
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero -->
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <h2>Detect Security Threats in Your Logs</h2>
                <p>Upload your server logs and instantly identify brute force attacks, SQL injection attempts, suspicious IPs, and more.</p>
                <div class="hero-features">
                    <div class="hero-feature">
                        <i class="fas fa-check-circle"></i> Brute Force Detection
                    </div>
                    <div class="hero-feature">
                        <i class="fas fa-check-circle"></i> SQL Injection Detection
                    </div>
                    <div class="hero-feature">
                        <i class="fas fa-check-circle"></i> IP Reputation Check
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container main-content">
        <!-- How It Works -->
        <div class="how-it-works">
            <div class="step">
                <div class="step-number">1</div>
                <div class="step-title">Upload Logs</div>
                <div class="step-desc">Apache, Nginx, SSH, or paste directly</div>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <div class="step-title">We Analyze</div>
                <div class="step-desc">Pattern matching & IP reputation</div>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <div class="step-title">Detect Threats</div>
                <div class="step-desc">Find attacks & suspicious activity</div>
            </div>
            <div class="step">
                <div class="step-number">4</div>
                <div class="step-title">Get Recommendations</div>
                <div class="step-desc">Actionable security advice</div>
            </div>
        </div>

        <!-- Upload Section -->
        <div class="card">
            <div class="card-header">
                <i class="fas fa-upload"></i>
                <h3>Upload or Paste Your Logs</h3>
            </div>

            <div class="upload-section">
                <div>
                    <div id="dropZone" class="file-drop-zone" onclick="document.getElementById('fileInput').click()">
                        <i class="fas fa-file-upload"></i>
                        <h4>Drag & Drop Log File</h4>
                        <p>or click to browse (max 10MB)</p>
                    </div>
                    <input type="file" id="fileInput" class="file-input" accept=".log,.txt" onchange="handleFileSelect(event)">
                    
                    <div id="selectedFile" class="selected-file" style="display: none;">
                        <i class="fas fa-file-alt"></i>
                        <div class="selected-file-info">
                            <div id="fileName" class="selected-file-name"></div>
                            <div id="fileSize" class="selected-file-size"></div>
                        </div>
                        <button class="remove-file" onclick="removeFile()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="supported-formats">
                        <span class="format-tag">Apache</span>
                        <span class="format-tag">Nginx</span>
                        <span class="format-tag">SSH</span>
                        <span class="format-tag">Auth.log</span>
                        <span class="format-tag">Access.log</span>
                    </div>
                </div>

                <div class="paste-area">
                    <textarea id="logContent" placeholder="Or paste your log content here..."></textarea>
                    <button class="try-sample" onclick="loadSampleLogs()">
                        <i class="fas fa-flask"></i> Load Sample Logs (Demo)
                    </button>
                </div>
            </div>

            <button id="submitBtn" class="submit-btn" onclick="analyzeLogs()">
                <i class="fas fa-search"></i>
                <span>Analyze Logs</span>
            </button>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="results-section">
            <!-- Threat Level Banner -->
            <div id="threatBanner" class="threat-banner clean fade-in">
                <div class="threat-icon">‚úÖ</div>
                <div class="threat-level">No Threats Detected</div>
                <div class="threat-subtitle">Your logs look clean</div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid fade-in">
                <div class="stat-card">
                    <div id="totalLines" class="stat-value">0</div>
                    <div class="stat-label">Lines Analyzed</div>
                </div>
                <div class="stat-card">
                    <div id="totalThreats" class="stat-value danger">0</div>
                    <div class="stat-label">Threats Found</div>
                </div>
                <div class="stat-card">
                    <div id="uniqueIPs" class="stat-value">0</div>
                    <div class="stat-label">Unique IPs</div>
                </div>
                <div class="stat-card">
                    <div id="bruteForce" class="stat-value warning">0</div>
                    <div class="stat-label">Brute Force IPs</div>
                </div>
            </div>

            <!-- Recommendations -->
            <div class="card fade-in">
                <div class="card-header">
                    <i class="fas fa-lightbulb"></i>
                    <h3>Recommendations</h3>
                </div>
                <div id="recommendations"></div>
            </div>

            <!-- Suspicious IPs -->
            <div class="card fade-in">
                <div class="card-header">
                    <i class="fas fa-user-secret"></i>
                    <h3>Suspicious IP Addresses</h3>
                </div>
                <div style="overflow-x: auto;">
                    <table class="ip-table">
                        <thead>
                            <tr>
                                <th>IP Address</th>
                                <th>Location</th>
                                <th>Requests</th>
                                <th>Threats</th>
                                <th>Abuse Score</th>
                                <th>Risk</th>
                            </tr>
                        </thead>
                        <tbody id="ipTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Threat Types -->
            <div class="card fade-in">
                <div class="card-header">
                    <i class="fas fa-bug"></i>
                    <h3>Threats by Type</h3>
                </div>
                <div id="threatTypes" class="threat-types"></div>
            </div>

            <!-- Recent Threats -->
            <div class="card fade-in">
                <div class="card-header">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Recent Threats Detected</h3>
                </div>
                <div id="recentThreats" class="threat-list"></div>
            </div>
        </div>

        <!-- Info Boxes -->
        <div class="info-box">
            <h4><i class="fas fa-shield-alt"></i> Threat Intelligence</h4>
            <p>We check suspicious IPs against AbuseIPDB and get location data from IPInfo to give you comprehensive threat intelligence.</p>
            <div class="api-status" id="apiStatus">
                <div class="api-badge"><span class="dot active"></span> AbuseIPDB</div>
                <div class="api-badge"><span class="dot active"></span> IPInfo</div>
            </div>
        </div>

        <div class="info-box">
            <h4><i class="fas fa-lock"></i> Privacy</h4>
            <p>Your log files are processed in memory and never stored. Only suspicious IPs are checked against external services.</p>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>
                Built by <a href="https://theghostpacket.com" target="_blank">TheGhostPacket</a> |
                Powered by AbuseIPDB & IPInfo
            </p>
            <p style="margin-top: 0.5rem; font-size: 0.8rem;">
                For educational and authorized security research only
            </p>
        </div>
    </footer>

    <script>
        let selectedFile = null;
        let isLoading = false;

        // File handling
        const dropZone = document.getElementById('dropZone');

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('drag-over');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            if (e.dataTransfer.files.length > 0) {
                handleFile(e.dataTransfer.files[0]);
            }
        });

        function handleFileSelect(event) {
            if (event.target.files.length > 0) {
                handleFile(event.target.files[0]);
            }
        }

        function handleFile(file) {
            if (file.size > 10 * 1024 * 1024) {
                alert('File too large. Maximum size is 10MB.');
                return;
            }
            selectedFile = file;
            document.getElementById('dropZone').style.display = 'none';
            document.getElementById('selectedFile').style.display = 'flex';
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
        }

        function removeFile() {
            selectedFile = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('dropZone').style.display = 'block';
            document.getElementById('selectedFile').style.display = 'none';
        }

        function formatFileSize(bytes) {
            if (bytes >= 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
            if (bytes >= 1024) return (bytes / 1024).toFixed(2) + ' KB';
            return bytes + ' bytes';
        }

        async function loadSampleLogs() {
            try {
                const response = await fetch('/api/sample-logs');
                const data = await response.json();
                document.getElementById('logContent').value = data.sample;
            } catch (error) {
                alert('Error loading sample: ' + error.message);
            }
        }

        async function analyzeLogs() {
            if (isLoading) return;

            const logContent = document.getElementById('logContent').value.trim();
            
            if (!selectedFile && !logContent) {
                alert('Please upload a file or paste log content.');
                return;
            }

            setLoading(true);

            try {
                let response;
                
                if (selectedFile) {
                    const formData = new FormData();
                    formData.append('file', selectedFile);
                    response = await fetch('/api/analyze', {
                        method: 'POST',
                        body: formData
                    });
                } else {
                    response = await fetch('/api/analyze', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ content: logContent })
                    });
                }

                const result = await response.json();
                
                if (result.error) {
                    alert(result.message);
                } else {
                    displayResults(result);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                setLoading(false);
            }
        }

        function setLoading(loading) {
            isLoading = loading;
            const btn = document.getElementById('submitBtn');
            if (loading) {
                btn.disabled = true;
                btn.innerHTML = '<div class="spinner"></div><span>Analyzing (checking IPs)...</span>';
            } else {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-search"></i><span>Analyze Logs</span>';
            }
        }

        function displayResults(result) {
            const resultsSection = document.getElementById('resultsSection');
            resultsSection.classList.add('active');

            // Threat banner
            const banner = document.getElementById('threatBanner');
            const summary = result.summary;
            
            banner.className = 'threat-banner fade-in ' + summary.overall_threat;
            
            const bannerContent = {
                'critical': { icon: 'üö®', text: 'Critical Threats Detected', subtitle: 'Immediate action required!' },
                'high': { icon: '‚ö†Ô∏è', text: 'High Risk Threats Found', subtitle: 'Multiple security issues detected' },
                'medium': { icon: 'üî∂', text: 'Medium Risk Activity', subtitle: 'Some suspicious activity found' },
                'low': { icon: 'üìã', text: 'Low Risk Activity', subtitle: 'Minor issues detected' },
                'clean': { icon: '‚úÖ', text: 'No Threats Detected', subtitle: 'Your logs look clean!' }
            };
            
            const content = bannerContent[summary.overall_threat];
            banner.innerHTML = `
                <div class="threat-icon">${content.icon}</div>
                <div class="threat-level">${content.text}</div>
                <div class="threat-subtitle">${content.subtitle}</div>
            `;

            // Stats
            document.getElementById('totalLines').textContent = summary.parsed_lines.toLocaleString();
            document.getElementById('totalThreats').textContent = summary.total_threats;
            document.getElementById('uniqueIPs').textContent = summary.unique_ips;
            document.getElementById('bruteForce').textContent = summary.brute_force_ips;

            // Recommendations
            const recsContainer = document.getElementById('recommendations');
            recsContainer.innerHTML = result.recommendations.map(rec => `
                <div class="recommendation ${rec.type}">
                    <div class="recommendation-icon">
                        ${rec.type === 'critical' ? '<i class="fas fa-exclamation-circle"></i>' : 
                          rec.type === 'warning' ? '<i class="fas fa-exclamation-triangle"></i>' : 
                          '<i class="fas fa-check-circle"></i>'}
                    </div>
                    <div class="recommendation-content">
                        <div class="recommendation-title">${rec.title}</div>
                        <div class="recommendation-desc">${rec.description}</div>
                        <div class="recommendation-action">üí° ${rec.action}</div>
                    </div>
                </div>
            `).join('');

            // IP Table
            const ipBody = document.getElementById('ipTableBody');
            if (result.suspicious_ips.length > 0) {
                ipBody.innerHTML = result.suspicious_ips.map(ip => `
                    <tr>
                        <td class="ip-address">${ip.ip}</td>
                        <td>${ip.country || 'Unknown'} ${ip.city ? '- ' + ip.city : ''}</td>
                        <td>${ip.requests}</td>
                        <td>${ip.threats}</td>
                        <td>${ip.abuse_score !== undefined ? ip.abuse_score + '%' : 'N/A'}</td>
                        <td>
                            <span class="risk-badge ${ip.risk_score >= 70 ? 'high' : ip.risk_score >= 30 ? 'medium' : 'low'}">
                                ${ip.risk_score >= 70 ? 'High' : ip.risk_score >= 30 ? 'Medium' : 'Low'}
                            </span>
                        </td>
                    </tr>
                `).join('');
            } else {
                ipBody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-muted);">No suspicious IPs found</td></tr>';
            }

            // Threat types
            const threatTypes = document.getElementById('threatTypes');
            const typeIcons = {
                'sql_injection': 'fa-database',
                'xss_attack': 'fa-code',
                'brute_force': 'fa-key',
                'path_traversal': 'fa-folder-open',
                'command_injection': 'fa-terminal',
                'scanner_tools': 'fa-radar',
                'suspicious_useragent': 'fa-robot',
                'enumeration': 'fa-search',
                'auth_failure': 'fa-lock'
            };

            const typeNames = {
                'sql_injection': 'SQL Injection',
                'xss_attack': 'XSS Attack',
                'brute_force': 'Brute Force',
                'path_traversal': 'Path Traversal',
                'command_injection': 'Command Injection',
                'scanner_tools': 'Scanner Tools',
                'suspicious_useragent': 'Suspicious User Agent',
                'enumeration': 'Directory Enumeration',
                'auth_failure': 'Auth Failures'
            };

            if (Object.keys(result.threats_by_type).length > 0) {
                threatTypes.innerHTML = Object.entries(result.threats_by_type).map(([type, count]) => `
                    <div class="threat-type-card">
                        <div class="threat-type-icon">
                            <i class="fas ${typeIcons[type] || 'fa-bug'}"></i>
                        </div>
                        <div>
                            <div class="threat-type-count">${count}</div>
                            <div class="threat-type-name">${typeNames[type] || type}</div>
                        </div>
                    </div>
                `).join('');
            } else {
                threatTypes.innerHTML = '<p style="color: var(--text-muted); text-align: center;">No specific threat patterns detected</p>';
            }

            // Recent threats
            const recentThreats = document.getElementById('recentThreats');
            if (result.recent_threats.length > 0) {
                recentThreats.innerHTML = result.recent_threats.slice(0, 20).map(threat => `
                    <div class="threat-item">
                        <div class="threat-item-icon ${threat.severity}">
                            <i class="fas fa-exclamation"></i>
                        </div>
                        <div class="threat-item-content">
                            <div class="threat-item-type">${typeNames[threat.type] || threat.type}</div>
                            <div class="threat-item-evidence">${threat.evidence || 'N/A'}</div>
                            <div class="threat-item-ip">IP: ${threat.ip || 'Unknown'}</div>
                        </div>
                    </div>
                `).join('');
            } else {
                recentThreats.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 1rem;">No threats detected</p>';
            }

            // Scroll to results
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Check API status
        async function checkApiStatus() {
            try {
                const response = await fetch('/api/status');
                const status = await response.json();
                document.getElementById('apiStatus').innerHTML = `
                    <div class="api-badge"><span class="dot ${status.abuseipdb ? 'active' : 'inactive'}"></span> AbuseIPDB</div>
                    <div class="api-badge"><span class="dot ${status.ipinfo ? 'active' : 'inactive'}"></span> IPInfo</div>
                `;
            } catch (error) {
                console.error('Error checking API status:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', checkApiStatus);
    </script>
</body>
</html>
